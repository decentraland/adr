
# Catalyst API and Protocol refinement 

## Context

The [Catalyst API](https://decentraland.github.io/catalyst-api-specs/) has been evolving and adding different functionalities, endpoints and parameters as needed by the evolving platform requirements. Because of this needs, some changes while good decissions at the moment to unblock features, were not thought hollistically or now they may be causing too much unneded Data Transfer cost or have room for perfomance improvement for the Catlysts core processes like Bootsraping and Syncronization. 

## Decision

After reviewing the Catalyst API we defined a set of changes to clean up and close a first version of the Catalyst Protocol. The changes that will be described below will enable us to: 
- Reduce Data Transfer cost by only narrow down the response bodies to only return the needed information
- Reduce plublic API complexity by hiding endpoints that are only inteended for troubleshooting, this will also reduce hits to endpoints that should not be used externally
- Improve that Catalyst bootsraping and synchronization time by reducing the amount of request and information recieved for the synchronization 
- Do a more efficient use of the DB
- Open the door to create new Catalyst implementation based on this protocol definition

List of API changes: 

| Endpoint                                                       | Deprecate YES/NO | Change Description                                                                                                                                                                                                                                                                                                                                                                                                                              |
|----------------------------------------------------------------|------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| /content/deployments                                           | YES              | This endpoint consumes DB resources inefficiently  as its the equivalent to a SELECT ALL.  The proposal is to deprecate this and add 2 new endpoints: one to retrieve the list of all pointers and  another to retrieve the history of a given list of pointers.  Catalyst synchronization will be done using SNAPSHOTS and Pointer Changes.   This endpoint also has a complex UX with the application of many filters and a lot of parameters |
| /lambdas/pointers/{entityType}                                 | NO               | New endpoint  Given an entity type (scene, wearables) this endpoint should return the list of all the pointers                                                                                                                                                                                                                                                                                                                                  |
| /lambdas/pointers/{entityType}/history?pointer=0,0&pointer=1,1 | NO               | New endpoint Given a pointer or list of pointers of the specified entity type, returns the history of deployments                                                                                                                                                                                                                                                                                                                               |
| /contents/{hashId}/active-entities                             | NO               | Change resource to /entities and include a parameter to retrieve inactive entities /entities?includeInactive=true                                                                                                                                                                                                                                                                                                                               |
| /content/failed-deployments                                    | YES              | This endpoint should be removed from the public API, and only be used with a key for the Catalyst Monitor and for troubleshooting or the auto-fix deployments functionality                                                                                                                                                                                                                                                                     |
| /lambdas/health                                                | NO               | We need to add more information like the Unhealthy message. Currently you get an unhealthy state and no information about why the service is unhealthy                                                                                                                                                                                                                                                                                          |
| /lambdas/contentv2/scenes                                      | YES              | Do we need the v2? this endpoint should be generic to retrieve the list of scenes of a given coordinates                                                                                                                                                                                                                                                                                                                                        |
| /lambdas/contentv2/parcel_info                                 | YES              | Same as above, we need to review the need of the v2 in the resource name and change it to be generic                                                                                                                                                                                                                                                                                                                                            |
| /lambdas/contentv2/contents/{cid}                              | YES              | There are old entities v2 that are still requested and may still be valid. We need to see if we can update these entities and deprecate this endpoint                                                                                                                                                                                                                                                                                           |
| /lambdas/crypto/validate-signature                             | YES              | This should be done with a library in the client side. Add a new lambda to return the Graph URL that we are using or add this information to the /lambdas/contracts/servers endpoint                                                                                                                                                                                                                                                            |
| /comms/islands                                                 | YES              | Remove from the public API and add a key to use this information for troubleshooting                                                                                                                                                                                                                                                                                                                                                            |
| /comms/islands/{islandId}                                      | YES              | Remove from the public API and add a key to use this information for troubleshooting                                                                                                                                                                                                                                                                                                                                                            |
| /comms/peers                                                   | YES              | Remove from the public API and add a key to use this information for troubleshooting                                                                                                                                                                                                                                                                                                                                                            |


# Status

In Progress.

# Consequences

/deploymnets: impact TBD 
The rest of the changes should not cause any impact on the Catalyst clients
